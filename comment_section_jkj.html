<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì‚´ë ¤ì¡° ë°©ëª…ë¡</title>
    <!-- CSS -->
    <link rel="stylesheet" href="./stylesheet/comment_section.css" />
    <!-- jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <!-- ì•„ì´ì½˜ -->
    <script
      src="https://kit.fontawesome.com/49be96d31f.js"
      crossorigin="anonymous"
    ></script>
    <link rel="stylesheet" href="./stylesheet/nav.css" />
    <script type="module">
      // Firebase SDK ë¼ì´ë¸ŒëŸ¬ë¦¬ ê°€ì ¸ì˜¤ê¸°
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import {
        collection,
        addDoc,
        setDoc,
        doc,
      } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
      import { deleteDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

      // Firebase êµ¬ì„± ì •ë³´ ì„¤ì •
      const firebaseConfig = {
        apiKey: "AIzaSyBCQnr4yIn-M8nJVTlLocbN8KIvFoMrzWQ",
        authDomain: "team-help-783b6.firebaseapp.com",
        projectId: "team-help-783b6",
        storageBucket: "team-help-783b6.appspot.com",
        messagingSenderId: "488622332237",
        appId: "1:488622332237:web:0adf9af9c955e644263f04",
        measurementId: "G-1KMBNSPH2M",
      };
      // Firebase ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      let backColor;

      //ë‚ ì§œ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
      let today = new Date();
      let year = today.getFullYear();
      let month = today.getMonth() + 1;
      let date = today.getDate();
      let hour = today.getHours();
      let minutes = today.getMinutes();
      let seconds = today.getSeconds();

      // id ë‚ ì§œ ì •ë³´
      let date_id = `${year}${("00" + month.toString()).slice(-2)}${(
        "00" + date.toString()
      ).slice(-2)}${hour}${minutes}${seconds}`;

      $("#sav").click(async function () {
        const color_list = [
          "#8ABDD1",
          "#8AD1CF",
          "#8AA7D1",
          "#EAEAEA",
          "#FFD5C2",
          "#FFCAC2",
        ];
        backColor = color_list[Math.floor(Math.random() * color_list.length)];
        let name = $("#inp_name").val();
        let text = $("#inp_txt").val();

        await setDoc(doc(db, "comments", "id" + date_id), {
          name: name,
          text: text,
          backColor: backColor,
          today: today,
          date_id: date_id,
        });

        location.reload();
      });

      let docs = await getDocs(collection(db, "comments"));
      docs.forEach((doc) => {
        let row = doc.data();
        let name = row["name"];
        let text = row["text"];
        let backColor = row["backColor"];
        let today = row["today"];
        let date_id = row["date_id"];
        let temp_html = `<div class="box" data-comment-id=${doc.id} style="background-color: ${backColor};">
        <div class="nickname-btn-container">
          <div class="nickname">${name}</div>
          <div class="btns">
          <button type="button" class="btn UDbtn del" style="background-color: rgb(221, 221, 221);">ì‚­ì œ</button>
          <button type="button" class="btn UDbtn ins" style="background-color: rgb(221, 221, 221);">ìˆ˜ì •</button>
          </div>
        </div>
        <div class="content">${text}</div>
        <div hidden>${today}</div>
      </div>`;

        $("#text_container").append(temp_html);
      });

      $(document).on("click", ".del", async function () {
        const commentID = $(this).closest(".box").attr("data-comment-id");
        try {
          await deleteDoc(doc(db, "comments", commentID));
          $(this).closest(".box").remove();
        } catch (error) {
          console.error("Error deleting document: ", error);
        }
      });
    </script>

    <script src="./comment_section.js" defer></script>
  </head>

  <body style="background-color: #eaeaea">
    <div class="page-header">
      <a id="menu-icon" class="menu-icon">
        <i class="fa fa-bars"></i>
      </a>
      <div id="navigation-bar" class="Logo">
        <li>
          <a href="./index.html" class="active">
            <i class="fa-solid fa-house"></i
          ></a>
        </li>
        <div id="left_btn">
          <a href="./comment_section_jkj.html">ë°©ëª…ë¡</a>
          <a href="./team_section.html">íŒ€ì†Œê°œ</a>
        </div>
      </div>
      <div class="nav">
        <a href="./personal/jw.html">ì´ì§€ìš°</a>
        <a href="./personal/sy.html">ê¶Œìˆ˜ì—°</a>
        <a href="./personal/my.html">ë°•ë¯¼ì˜</a>
        <a href="./personal/hw.html">ì´í˜„ìš±</a>
        <a href="./personal/kj.html">ì¥ê²½ì§„</a>
      </div>
    </div>
    <div class="titlebox">
      <div>
        <h2 class="title">ì‚´ë ¤ì¡° ë°©ëª…ë¡ âœï¸</h2>
      </div>
      <div class="subtitle">
        <h4>ë°˜ê°‘ìŠµë‹ˆë‹¤ í•œë§ˆë””ì”© ë‚¨ê²¨ì£¼ì„¸ìš”!</h4>
      </div>
      <div class="mycommentgbox" id="commentgbox">
        <div class="form-floating">
          <input
            type="name"
            class="form-control"
            id="inp_name"
            maxlength="10"
          />
          <label for="floatingInput">ë‹‰ë„¤ì„ :</label>
        </div>
        <div class="form-floating">
          <input type="text" class="form-control" id="inp_txt" maxlength="50" />
          <label for="floatingInput">ë‚´ìš© : </label>
        </div>
        <div class="inputbtn">
          <button
            id="sav"
            type="button"
            class="btn"
            style="background-color: #ffd5c2"
          >
            ì…ë ¥
          </button>
          <button
            type="button"
            id="cancell"
            class="btn"
            style="background-color: rgb(194, 191, 191)"
          >
            ì·¨ì†Œ
          </button>
        </div>
      </div>
      <div id="text_container" class="comment_box">
        <!-- ì´í•˜ ìƒëµ -->
      </div>
    </div>
    <div class="commentinput">
      <div class="editor">
        <h6 style="margin-top: 40px">ì—¬ê¸°ë¥¼ ëˆŒëŸ¬ ë°©ëª…ë¡ì„ ì‘ì„±í•˜ì„¸ìš” ğŸ‘‰</h6>
        <a id="btn_editor" class="new_comment">
          <i class="fa-regular fa-pen-to-square fa-4x"></i
        ></a>
      </div>
    </div>
  </body>
</html>
